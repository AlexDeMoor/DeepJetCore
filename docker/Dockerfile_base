
#update to cuda 10.1
FROM nvidia/cuda:10.1-cudnn7-devel-ubuntu18.04 


SHELL ["/bin/bash", "-c"]

#base
RUN apt-get update
RUN apt-get install -y python3.7-dev python3-pip
RUN pip3 install --upgrade pip
RUN ldconfig

#basic tools
RUN apt-get install -y wget nano emacs
RUN apt-get install -y libboost-all-dev
RUN apt-get install -y git


#nvtop deps - doesn't really work
#RUN apt-get install -y cmake libncurses5-dev libncursesw5-dev 
#
#
#RUN mkdir /tempnvtop && cd /tempnvtop && \
#    git clone https://github.com/Syllo/nvtop.git && \
#    mkdir -p nvtop/build && cd nvtop/build && \
#    cmake .. && \
#    make && \
#    make install && \
#    cd && \
#    rm -rf /tempnvtop
    

## root dependencies
RUN apt-get install -y libx11-dev libxpm-dev libxft-dev libxext-dev cmake

#for graphics stuff, pretty big, but ok...
RUN export DEBIAN_FRONTEND=noninteractive && \
    apt-get install -y gtk+3.0

RUN mkdir /temproot && \
    cd /temproot && \
    git clone http://github.com/root-project/root.git && \
    cd root && \
    git checkout -b v6-18-04 v6-18-04 
RUN cd /temproot && \
    mkdir build && \
    cd build && \
    cmake -Dpython=ON -Dpython3=ON -DPYTHON_EXECUTABLE=/usr/bin/python3  ../root 
RUN cd /temproot/build && \
    make -j5 && \
    make install && \
    rm -rf /temproot


#ensure import ROOT
ENV PYTHONPATH="/usr/local/lib:${PYTHONPATH}"



RUN export DEBIAN_FRONTEND=noninteractive && \
    apt-get install -y python3-tk
RUN apt-get install -y locales


RUN pip3 install numpy
RUN pip3 install root_numpy
RUN pip3 install scikit-learn
RUN pip3 install scikit-image
RUN pip3 install h5py
RUN pip3 install uproot Pillow scipy seaborn
RUN pip3 install scikit-learn
RUN pip3 install scikit-image
RUN pip3 install matplotlib

#may be useful
RUN pip3 install opencv-python
RUN pip3 install easydict tqdm
RUN pip3 install Cython
RUN pip3 install numba

RUN pip3 --no-cache-dir install tensorflow==2.0.0

RUN apt-get update --fix-missing 
    
RUN export DEBIAN_FRONTEND=noninteractive && \
    apt-get install -y krb5-user && \
    sed -i 's/default_realm = ATHENA.MIT.EDU/default_realm = CERN.CH/g' /etc/krb5.conf 
    
RUN apt-get update --fix-missing 
RUN export DEBIAN_FRONTEND=noninteractive && \
    apt-get install -y openafs-krb5 openafs-dbserver


#for me ;)    
RUN apt-get install -y zsh 

RUN apt-get install -y ffmpeg
#RUN apt-get install -y nvtop

##gpu specific stuff
RUN pip3 install gpustat 
RUN pip3 install setGPU


